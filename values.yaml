# plex-auto-skip â€“ base chart for PlexAutoSkip (bjw-s app-template).
# This chart only runs the app and mounts a volume at /config (default: PVC).
# Config files (config.ini, logging.ini, custom.json) are NOT created here.
# Parent chart (e.g. homelab/helm/plex) can create a ConfigMap, Secret, or ExternalSecret
# and override skip.persistence.config to mount it (type: configMap or secret, name: <resource-name>).

fullnameOverride: plex-auto-skip

skip:
  global:
    fullnameOverride: plex-auto-skip

  defaultPodOptions:
    securityContext:
      runAsNonRoot: true
      runAsUser: 911
      runAsGroup: 911
      fsGroup: 911

  ingress:
    main:
      enabled: false

  # No config templating in this chart. Parent chart creates ConfigMap/Secret/ExternalSecret and overrides persistence.
  configMaps:
    pas-config:
      enabled: false
      data: {}

  controllers:
    main:
      enabled: true
      type: deployment
      replicas: 1
      initContainers: {}
      containers:
        main:
          image:
            repository: ghcr.io/mdhiggins/plexautoskip-docker
            tag: latest
            pullPolicy: IfNotPresent
          env:
            PUID: "911"
            PGID: "911"
            TZ: America/Los_Angeles
            PAS_PATH: /usr/local/pas
            PAS_UPDATE: "false"
            LSIO_NON_ROOT_USER: "true"
          probes:
            startup:
              enabled: false
            liveness:
              enabled: false
            readiness:
              enabled: false
          resources:
            requests:
              cpu: 50m
              memory: 64Mi
            limits:
              cpu: 200m
              memory: 128Mi
          securityContext:
            runAsNonRoot: true
            runAsUser: 911
            runAsGroup: 911
            readOnlyRootFilesystem: false
            allowPrivilegeEscalation: false

  service:
    main:
      enabled: false

  # Default: PVC mounted at /config. Parent chart overrides to type: secret or type: configMap with name: <x> when it creates the config.
  persistence:
    config:
      enabled: true
      type: persistentVolumeClaim
      accessMode: ReadWriteOnce
      size: 100Mi
      globalMounts:
        - path: /config
          readOnly: false
    pas-config-files:
      enabled: false
      type: configMap
      identifier: pas-config
